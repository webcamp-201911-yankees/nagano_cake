<!DOCTYPE html><html><head><meta charset="utf-8" /><title>enumを使うとArgumentError in TasksController#create =&amp;gt; &amp;#39;2&amp;#39; is not a valid status_id - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="+tzJPKJNlk/DD4Ouc/xRk+dYMbZhNvcqf/sIntuXpafpEuAps7qU4gD7CWNjRtMgH07Cwret3CWMgvGYqTZkBQ==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-c620d3e403342b1022967ba5e3db1aaa.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-ec5ba42a24ae923f16825592efdc356f.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/style-374b965692f66f218d89cd715864579b.min.css" /><script src="https://cdn.qiita.com/assets/public/v3-bundle-5c87a3f3d074de5070ca70d8e61bbdd7.min.js" defer="defer"></script><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="enumを使うとArgumentError in TasksController#create =&gt; &#39;2&#39; is not a valid status_id - Qiita"><meta property="og:image" content="https://cdn.qiita.com/assets/qiita-fb-fe28c64039d925349e620ba55091e078.png"><meta property="og:description" content="久しぶりに遭遇しました。`rails`で`enum`を使う時に起きるこのエラー。
今回が2回目の遭遇なのですが、前回は根本的な解決をしないまま小手先の変更で退却してしまいました。
なので今回はこのエラーとじっくり向き合ってみようと思い..."><meta content="https://qiita.com/e-yoshida/items/fa4d300786fbedf9845d" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="Rails,ActiveRecord,enum" name="keywords" /></head><body><div class="allWrapper"><div class="st-HeaderContainer"><div id="GlobalHeader-react-component-19990726-11ee-45c5-9373-40b28d635677"><div class="st-Header"><div class="st-Header_container"><div class="st-Header_start"><a href="/" class="st-Header_logo mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426.57 130"><circle cx="167.08" cy="21.4" r="12.28"></circle><path d="M250.81 29.66h23.48v18.9h-23.48z"></path><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z"></path><circle cx="216.33" cy="21.4" r="12.28"></circle></svg></a><div><div class="st-Header_realmSelector" tabindex="0"><span class="fa fa-fw fa-caret-down"></span></div><div class="st-Header_dropdown st-RealmSelector"><div class="st-RealmSelector_realms"><a class="st-Header_dropdownItem st-RealmItem" href="https://qiita.com/"><div class="st-RealmItem_statusIcon"><span class="fa fa-fw fa-check"></span></div><div class="st-RealmItem_humanName">Qiita</div></a></div><hr/><div class="st-RealmSelector_supplements"><div class="st-RealmSelector_label">You are not logged in to any team</div><a href="https://teams-center.qiita.com/find_team" class="st-Header_dropdownItem st-RealmSelectorSupplement"><div class="st-RealmSelectorSupplement_icon"><span class="fa fa-fw fa-sign-in"></span></div><div>Log in to Qiita Team...</div></a></div></div></div><div><div class="st-Header_community" tabindex="0">Community<span class="fa fa-fw fa-caret-down ml-1of2"></span></div><div class="st-Header_dropdown"><a href="/users" class="st-Header_dropdownItem"><span class="fa fa-fw fa-users mr-1of2"></span>List of all users</a><a href="/organizations" class="st-Header_dropdownItem"><span class="fa fa-fw fa-building-o mr-1of2"></span>List of all organizatioins</a><a href="/advent-calendar" class="st-Header_dropdownItem"><span class="fa fa-fw fa-calendar mr-1of2"></span>Advent Calendar</a><div class="st-Header_dropdownSeparator"></div><a href="https://jobs.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank"><span class="fa fa-fw fa-search mr-1of2"></span>Qiita Jobs</a><a href="https://qiitadon.com/" class="st-Header_dropdownItem" target="_blank"><span class="fa fa-fw fa-comments-o mr-1of2"></span>Qiitadon (β)</a><a href="https://zine.qiita.com/?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=header" class="st-Header_dropdownItem" target="_blank"><span class="fa fa-fw fa-newspaper-o mr-1of2"></span>Qiita:Zine</a><div class="st-Header_dropdownSeparator"></div><a href="https://help.qiita.com/ja/articles/qiita-community-guideline" class="st-Header_dropdownItem" target="_blank"><span class="fa fa-fw fa-book mr-1of2"></span>Community Guideline</a><a href="https://help.qiita.com/ja/articles/qiita-article-guideline" class="st-Header_dropdownItem" target="_blank"><span class="fa fa-fw fa-book mr-1of2"></span>How to write good articles</a></div></div><form class="st-Header_search" action="/search" method="get"><span class="fa fa-search"></span><input type="search" class="st-Header_searchInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form><div class="st-Header_searchButton"><span class="fa fa-search"></span></div></div><div class="st-Header_end"><a class="st-Header_signupButton" href="/signup?redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d">Signup</a><a class="st-Header_loginLink" href="/login?redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d">Login</a></div><div class="st-Header_overlay"></div><form class="st-Header_searchModal" action="/search" method="get"><input type="text" class="st-Header_searchModalInput" autoComplete="off" placeholder="Search" value="" name="q" required=""/></form></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeader" data-dom-id="GlobalHeader-react-component-19990726-11ee-45c5-9373-40b28d635677">{"unreadNotificationsCount":null,"realms":[{"humanName":"Qiita","isCurrentRealm":true,"isQiita":true,"isQiitaTeam":false,"loggedInUser":null,"teamId":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","isTeamOnlyUser":null,"currentUser":null}</script>
      
</div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><div class="ac-CampaignLink"><div class="ac-CampaignLink_container"><a href="/advent-calendar/2019">Qiita Advent Calendar 2019 開催中！ 最高に盛り上がる年末にしていきましょう :)</a><a href="/advent-calendar/2019">&gt; カレンダーを見る</a></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/%23%3CQiita::Graph::Result:0x0000558be1254f50%3E","name":"Rails"}}]}</script><script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","href":"https://qiita.com/e-yoshida/items/fa4d300786fbedf9845d","location":"/e-yoshida/items/fa4d300786fbedf9845d","scheme":"https","host":"qiita.com","port":null,"pathname":"/e-yoshida/items/fa4d300786fbedf9845d","search":null,"httpAcceptLanguage":null,"actionPath":"public/items#show","settings":{"analyticsTrackingId":"UA-24675221-12","mixpanelToken":"17d24b448ca579c365d2d1057f3a1791","assetsMap":{},"csrfToken":"9sbnvEc7lfjWrmyKd5ALnY3AtjprsYosrx1jxxWT69TlCM6pVsyXVRVa5kdnKokuddZFTr0qoSNcZJrBZzIqdg==","locale":"en"},"currentUser":null,"isLoggedIn":false,"serverSide":false}</script>
<div id="PersonalPublicArticle-react-component-94013286-bee5-4531-a5ba-00f272337495"><div class="p-items" itemscope="" itemType="http://schema.org/Article"><div class="p-items_wrapper"><div class="p-items_container"><div class="p-items_main"><div class="p-items_article"><div class="it-Header"><div class="u-flex-center-between mb-3"><div class="it-Header_info"><div class="it-Header_author"><a href="/e-yoshida"><img src="https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F246934%2Fprofile-images%2F1527209611?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;lossless=0&amp;w=48&amp;s=f1f102c09b3dfa60cd9252766d7cd506" alt="e-yoshida" class="it-Header_authorImage"/></a><a href="/e-yoshida" class="it-Header_authorName">@<!-- -->e-yoshida</a></div><div class="it-Header_time"><span><meta content="2018-05-17T02:32:28Z" itemProp="datePublished"/><time dateTime="2018-05-25T08:12:36Z" itemProp="dateModified">updated at 2018-05-25</time></span></div><div class="it-Header_meta"><div class="it-Header_manipulate"><div class="it-Header_dropdown"><span class="it-Header_dropdownToggle" tabindex="0"><span class="fa fa-ellipsis-h fa-lg"></span></span><div class="st-Dropdown right"><div><div class="it-Header_dropdown-title">Improve article</div><a class="st-Dropdown_item" href="/drafts/fa4d300786fbedf9845d/edit"><span class="fa fa-fw fa-code-fork pr-1"></span>Send edit request</a><div class="st-Dropdown_separator"></div></div><div class="it-Header_dropdown-title">Article information</div><a class="st-Dropdown_item" href="/e-yoshida/items/fa4d300786fbedf9845d/revisions"><span class="fa fa-fw fa-history pr-1"></span>Revisions</a><a class="st-Dropdown_item" href="/e-yoshida/items/fa4d300786fbedf9845d/patches"><span class="fa fa-fw fa-inbox pr-1"></span>Edit Requests</a><a class="st-Dropdown_item" href="/e-yoshida/items/fa4d300786fbedf9845d/likers"><span class="fa fa-fw fa-thumbs-up pr-1"></span>Show all likers</a><a class="st-Dropdown_item" href="/e-yoshida/items/fa4d300786fbedf9845d.md"><span class="fa fa-fw fa-file-text-o pr-1"></span>Show article in Markdown</a><div class="st-Dropdown_separator"></div><div class="st-Dropdown_item"><span class="fa fa-fw fa-flag pr-1"></span>Report article</div></div></div></div><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body"><form><div class="st-Form"><span class="st-Form_label">Help us understand the problem. What is going on with this article?</span></div><div class="st-Form"><label><input type="radio" name="reason" value="spam" required=""/>It&#x27;s spam</label></div><div class="st-Form"><label><input type="radio" name="reason" value="harassment" required=""/>It&#x27;s abusive or harmful</label></div><div class="st-Form"><label><input type="radio" name="reason" value="inappropriate_content" required=""/>It contains inappropriate content</label></div><div class="st-Form st-Form-right"><input type="submit" class="st-Form_submit" value="Submit"/></div></form></div></div></div></div></div><h1 class="it-Header_title" itemProp="headline">enumを使うとArgumentError in TasksController#create =&gt; &#x27;2&#x27; is not a valid status_id</h1><div class="it-Tags"><a href="/tags/rails" class="it-Tags_item"><span>Rails</span></a><a href="/tags/activerecord" class="it-Tags_item"><span>ActiveRecord</span></a><a href="/tags/enum" class="it-Tags_item"><span>enum</span></a></div></div><div class="it-DeprecationAlert_one mb-5 p-2"><span class="fa fa-warning mr-1"></span>More than 1 year has passed since last update.</div><section class="it-MdContent" itemProp="articleBody"><div id="personal-public-article-body"><div><p>久しぶりに遭遇しました。<code>rails</code>で<code>enum</code>を使う時に起きるこのエラー。<br>
今回が2回目の遭遇なのですが、前回は根本的な解決をしないまま小手先の変更で退却してしまいました。<br>
なので今回はこのエラーとじっくり向き合ってみようと思います。</p>

<h2>
<span id="現在の状況" class="fragment"></span><a href="#%E7%8F%BE%E5%9C%A8%E3%81%AE%E7%8A%B6%E6%B3%81"><i class="fa fa-link"></i></a>現在の状況</h2>

<p>タスクを管理するアプリケーションを作成中です。<br>
<code>Task</code>モデルの<code>status_id</code>カラムを<code>Integer</code>型保存して、<br>
ビューで表示する際に<code>enum</code>を利用して数値に対応したステータスを表示させたいと考えています。<br>
以下コードになります。</p>

<h3>
<span id="dbschemarb" class="fragment"></span><a href="#dbschemarb"><i class="fa fa-link"></i></a>db/schema.rb</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Schema</span><span class="p">.</span><span class="nf">define</span><span class="p">(</span><span class="ss">version: </span><span class="mi">20180516232642</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">create_table</span> <span class="s2">"tasks"</span><span class="p">,</span> <span class="ss">force: :cascade</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="s2">"title"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="s2">"detail"</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"detail"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"created_at"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"updated_at"</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="s2">"deadline"</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="s2">"status_id"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>

<h3>
<span id="appmodelstaskrb" class="fragment"></span><a href="#appmodelstaskrb"><i class="fa fa-link"></i></a>app/models/task.rb</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="k">class</span> <span class="nc">Task</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">enum</span> <span class="ss">status_id: </span><span class="sx">%i[undefined untouched in_prigress done]</span>
<span class="k">end</span>
</pre></div></div>

<h3>
<span id="appcontrollerstasks_controllerrb" class="fragment"></span><a href="#appcontrollerstasks_controllerrb"><i class="fa fa-link"></i></a>app/controllers/tasks_controller.rb</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="k">class</span> <span class="nc">TasksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

<span class="err">　　</span> <span class="o">~</span><span class="err">一部省略</span><span class="o">~</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Succeeded to save the task!!'</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Succeeded to save the task!!'</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">task_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:task</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:detail</span><span class="p">,</span> <span class="ss">:deadline</span><span class="p">,</span> <span class="ss">:status_id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>

<h3>
<span id="apphelperstasks_helperrb" class="fragment"></span><a href="#apphelperstasks_helperrb"><i class="fa fa-link"></i></a>app/helpers/tasks_helper.rb</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="k">module</span> <span class="nn">TasksHelper</span>

  <span class="k">def</span> <span class="nf">deadline_format</span><span class="p">(</span><span class="n">datetime</span><span class="p">)</span>
    <span class="n">datetime</span><span class="p">.</span><span class="nf">present?</span> <span class="p">?</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s1">'%Y.%m.%d'</span><span class="p">)</span> <span class="p">:</span> <span class="n">t</span><span class="p">(</span><span class="ss">:undefined</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">status_format</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
    <span class="n">status</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span>  <span class="n">t</span><span class="p">(</span><span class="ss">:undefined</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>

<h3>
<span id="appviewstasks_formslim" class="fragment"></span><a href="#appviewstasks_formslim"><i class="fa fa-link"></i></a>app/views/tasks/_form.slim</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>= form_for(@task) do |f|
  .form_title
    = f.text_field :title, placeholder: t(:title), class: "form_title__text_field"
  .form_detail
    = f.text_area :detail, placeholder: t(:detail), class: "form_detail__text_area"
  .form_name
    .form_name__font = t(:deadline)
  .form_deadline
    = f.date_select :deadline, class: "form_deadline_select"
  .form_status
    = f.select(:status_id, {undefined: 0, untouched: 1, in_progress: 2, done: 3}, { class: "form_status__select" })
  .form_submit
    = f.submit t(:submit), class: "form_submit__button"
</pre></div></div>

<p>タスクを新規で保存する際も、既存のタスクを更新する際も同じフォームを利用しています。<br>
（<code>tasks/new.slim</code>と<code>views/tasks/edit.slim</code>の両方で同じ<code>views/tasks/_form.slim</code>を<code>render</code>しています。）</p>

<h3>
<span id="appviewstasksindexslim" class="fragment"></span><a href="#appviewstasksindexslim"><i class="fa fa-link"></i></a>app/views/tasks/index.slim</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>  tbody.task_table__body
    - @tasks.each.with_index do |task, n|
      tr.task_table__line{ id = n }
        td.task_table__line__priority = t(:s)
        td.task_table__line__deadline = deadline_format(task.deadline)
        td.task_table__line__title = task.title
        td.task_table__line__detail = task.detail
        td.task_table__line__status = status_format(task.status_id)
</pre></div></div>

<h2>
<span id="問題点" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E7%82%B9"><i class="fa fa-link"></i></a>問題点</h2>

<p>この状態で新規タスクの作成と既存のタスクの更新を行うと以下のようなエラーが出てきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.7ms)

ArgumentError ('2' is not a valid status_id):
</pre></div></div>

<p>エラーの意味は理解できます。<br>
引数としての<code>status_id</code>が無効な値です。そして<code>'2' is invalid</code>と表示されているので、<br>
おそらく<code>Integer</code>で取得されるべき値が<code>String</code>で来ています、とのことだと思います。</p>

<p>試しに<code>app/models/task.rb</code>の<code>enum</code>の記述をコメントアウトした状態で同じ動作を行ってみましたが、エラーは出てこなかったので<code>enum</code>に問題があるようです。</p>

<h2>
<span id="試行錯誤" class="fragment"></span><a href="#%E8%A9%A6%E8%A1%8C%E9%8C%AF%E8%AA%A4"><i class="fa fa-link"></i></a>試行錯誤</h2>

<p>先ず、本当に<code>status_id</code>が<code>String</code>型で取得されているのかを<code>binding.pry</code>を使って調べてみました。<br>
（あくまで、型を調べるためなのでエラーを回避するために<code>app/models/task.rb</code>の<code>enum</code>の記述をコメントアウトした状態で行いました。）</p>

<h3>
<span id="appcontrollerstasks_controllerrb-1" class="fragment"></span><a href="#appcontrollerstasks_controllerrb-1"><i class="fa fa-link"></i></a>app/controllers/tasks_controller.rb</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="k">class</span> <span class="nc">TasksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

<span class="err">　　</span> <span class="o">~~</span><span class="err">一部省略</span><span class="o">~~</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">bindung</span><span class="p">.</span><span class="nf">pry</span>
    <span class="vi">@task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Succeeded to save the task!!'</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Succeeded to save the task!!'</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">task_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:task</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:detail</span><span class="p">,</span> <span class="ss">:deadline</span><span class="p">,</span> <span class="ss">:status_id</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>

<p>以下がデバックした際のターミナル画面です。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
    <span class="mi">14</span><span class="p">:</span> <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">15</span><span class="p">:</span>   <span class="nb">binding</span><span class="p">.</span><span class="nf">pry</span>
 <span class="o">=&gt;</span> <span class="mi">16</span><span class="p">:</span>   <span class="vi">@task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
    <span class="mi">17</span><span class="p">:</span>   <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">18</span><span class="p">:</span>     <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Succeeded to save the task!!'</span>
    <span class="mi">19</span><span class="p">:</span>   <span class="k">else</span>
    <span class="mi">20</span><span class="p">:</span>     <span class="n">render</span> <span class="s1">'new'</span>
    <span class="mi">21</span><span class="p">:</span>     <span class="k">return</span>
    <span class="mi">22</span><span class="p">:</span>   <span class="k">end</span>
    <span class="mi">23</span><span class="p">:</span> <span class="k">end</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; task_params</span>
<span class="o">=&gt;</span> <span class="o">&lt;</span><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span> <span class="p">{</span><span class="s2">"title"</span><span class="o">=&gt;</span><span class="s2">"test for status"</span><span class="p">,</span> <span class="s2">"detail"</span><span class="o">=&gt;</span><span class="s2">"detail"</span><span class="p">,</span> <span class="s2">"deadline(1i)"</span><span class="o">=&gt;</span><span class="s2">"2018"</span><span class="p">,</span> <span class="s2">"deadline(2i)"</span><span class="o">=&gt;</span><span class="s2">"5"</span><span class="p">,</span> <span class="s2">"deadline(3i)"</span><span class="o">=&gt;</span><span class="s2">"17"</span><span class="p">,</span> <span class="s2">"status_id"</span><span class="o">=&gt;</span><span class="s2">"2"</span><span class="p">}</span> <span class="ss">permitted: </span><span class="kp">true</span><span class="o">&gt;</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; status = task_params[:status_id]</span>
<span class="o">=&gt;</span> <span class="s2">"2"</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; status.class</span>
<span class="o">=&gt;</span> <span class="no">String</span>
</pre></div></div>

<p>やっぱり…<br>
そして<code>datetime</code>型であるはずの<code>deadline</code>も<code>string</code>になっている…</p>

<p>今度は<code>binding.pry</code>の位置を変えて実行。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
    <span class="mi">14</span><span class="p">:</span> <span class="k">def</span> <span class="nf">create</span>
    <span class="mi">15</span><span class="p">:</span>   <span class="vi">@task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
    <span class="mi">16</span><span class="p">:</span>   <span class="nb">binding</span><span class="p">.</span><span class="nf">pry</span>
 <span class="o">=&gt;</span> <span class="mi">17</span><span class="p">:</span>   <span class="k">if</span> <span class="vi">@task</span><span class="p">.</span><span class="nf">save</span>
    <span class="mi">18</span><span class="p">:</span>     <span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Succeeded to save the task!!'</span>
    <span class="mi">19</span><span class="p">:</span>   <span class="k">else</span>
    <span class="mi">20</span><span class="p">:</span>     <span class="n">render</span> <span class="s1">'new'</span>
    <span class="mi">21</span><span class="p">:</span>     <span class="k">return</span>
    <span class="mi">22</span><span class="p">:</span>   <span class="k">end</span>
    <span class="mi">23</span><span class="p">:</span> <span class="k">end</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; @task</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Task:0x00007f981adc0398</span>
 <span class="ss">id: </span><span class="kp">nil</span><span class="p">,</span>
 <span class="ss">title: </span><span class="s2">"明日の夕方、海岸へ行く"</span><span class="p">,</span>
 <span class="ss">detail: </span><span class="s2">"detail"</span><span class="p">,</span>
 <span class="ss">created_at: </span><span class="kp">nil</span><span class="p">,</span>
 <span class="ss">updated_at: </span><span class="kp">nil</span><span class="p">,</span>
 <span class="ss">deadline: </span><span class="no">Fri</span><span class="p">,</span> <span class="mi">18</span> <span class="no">May</span> <span class="mi">2018</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="no">JST</span> <span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mo">00</span><span class="p">,</span>
 <span class="ss">status_id: </span><span class="mi">1</span><span class="o">&gt;</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; @task[:status_id]</span>
<span class="o">=&gt;</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; @task[:status_id].class</span>
<span class="o">=&gt;</span> <span class="no">Integer</span>
</pre></div></div>

<p>ちゃんと<code>integer</code>になっていました。<br>
<code>deadline</code>も</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; @task[:deadline].class</span>
<span class="o">=&gt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TimeWithZone</span>
</pre></div></div>

<p>一瞬、えっ？っとなりましたがこれで問題ないようです。以下参照。<br>
<a href="http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html" class="autolink" rel="nofollow noopener" target="_blank">http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html</a></p>

<p>では、<code>task_params</code>自体はどのようになっているのだろうか。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; task_params</span>
<span class="o">=&gt;</span> <span class="o">&lt;</span><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span> <span class="p">{</span><span class="s2">"title"</span><span class="o">=&gt;</span><span class="s2">"TEST"</span><span class="p">,</span> <span class="s2">"detail"</span><span class="o">=&gt;</span><span class="s2">"detail"</span><span class="p">,</span> <span class="s2">"deadline(1i)"</span><span class="o">=&gt;</span><span class="s2">"2018"</span><span class="p">,</span> <span class="s2">"deadline(2i)"</span><span class="o">=&gt;</span><span class="s2">"5"</span><span class="p">,</span> <span class="s2">"deadline(3i)"</span><span class="o">=&gt;</span><span class="s2">"19"</span><span class="p">,</span> <span class="s2">"status_id"</span><span class="o">=&gt;</span><span class="s2">"2"</span><span class="p">}</span> <span class="ss">permitted: </span><span class="kp">true</span><span class="o">&gt;</span>
<span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;TasksController&gt;)&gt; task_params[:status_id].class</span>
<span class="o">=&gt;</span> <span class="no">String</span>
</pre></div></div>

<p>こちらは変わらず<code>string</code>のまま。</p>

<h2>
<span id="推測" class="fragment"></span><a href="#%E6%8E%A8%E6%B8%AC"><i class="fa fa-link"></i></a>推測</h2>

<p>上記の試行錯誤を基に<code>@task</code>に値が代入される流れを確認。<br>
※まだ<code>ActionController</code>のソースをあまり理解できないのであくまで推測に近いです。</p>

<p>①<code>form_for</code>で入力して、取得した値は<strong>キーもバリューも全て<code>String</code>のパラメーターのハッシュ</strong>に格納される。（そりゃ、画面から送られてくるPOSTデータには型情報が無いですもんね…）</p>

<p>②<code>Task</code>クラスのインスタンスを作成する際に<code>ActiveRecord</code>が<code>db/schema.rb</code>を参照して、キーがシンボルのカラム名のハッシュオブジェクトを作成する。（引数なしの<code>new</code>メソッドの後に<code>binding.pry</code>を実行して確認。）</p>

<p>③<code>ActiveRecord</code>がパラメーターのハッシュのバリューを<code>db/schema.rb</code>に基づいて適切な形（データ型）に変換して、<code>Task</code>クラスのインスタンスの該当キーのバリューとして代入する。</p>

<p>そして③が実行される際に、本来<code>Integer</code>であるはずのの<code>status_id</code>が<code>String</code>のままでハッシュに渡されているからエラーが起こると思っていました。</p>

<p>けど、よく考えたらそんなことあり得ないです。<code>deadline</code>はちゃんと<code>ActiveSupport::TimeWithZone</code>クラスのオブジェクトに変換されているのだから。</p>

<p>ということは、<code>enum</code>に関して根幹的に誤解している可能性が出てきました。</p>

<h2>
<span id="enumに関する勘違い" class="fragment"></span><a href="#enum%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%8B%98%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a><code>enum</code>に関する勘違い</h2>

<p>結論から言うと自分は今まで<code>enum</code>の機能は、DBに保存されている数値を取り出した際に、対応する文字列に変換して扱うことができることだと思っていました。</p>

<p>しかし実際は<strong>モデルを介してデータのやり取りをする際に数値と、それに対応する文字列を変換する</strong>ことが<code>enum</code>の機能なのです。（日本語が分かり辛くてすいません。要は数値から文字列への変換を一方通行で行うわけじゃないよ、ということです。）</p>

<p>つまり、値がモデルクラスのインスタンスに代入される際も、<code>enum</code>で設定した値しか受け付けないと言うことです。と言うことはただ単に、フォームで設定するバリューを<code>enum</code>で設定している文字列に変えれば良いだけ。そもそもエラーを読んだ時点で認識を誤っていました。</p>

<h2>
<span id="解決" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA"><i class="fa fa-link"></i></a>解決</h2>

<p>フォームを以下のように編集すればOK</p>

<h3>
<span id="appviewstasks_formslim-1" class="fragment"></span><a href="#appviewstasks_formslim-1"><i class="fa fa-link"></i></a>app/views/tasks/_form.slim</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>= form_for(@task) do |f|
  .form_title
    = f.text_field :title, placeholder: t(:title), class: "form_title__text_field"
  .form_detail
    = f.text_area :detail, placeholder: t(:detail), class: "form_detail__text_area"
  .form_name
    .form_name__font = t(:deadline)
  .form_deadline
    = f.date_select :deadline, class: "form_deadline_select"
  .form_status
    = f.select(:status_id, {undefined: 'undefined', untouched: 'untouched', in_progress: 'in_progress', done: 'done'}, { class: "form_status__select" })
  .form_submit
    = f.submit t(:submit), class: "form_submit__button"
</pre></div></div>

<p>以上、たかが<code>enum</code>されど<code>enum</code>でした。</p>

<h2>
<span id="お願い" class="fragment"></span><a href="#%E3%81%8A%E9%A1%98%E3%81%84"><i class="fa fa-link"></i></a>お願い</h2>

<p>記事の内容に誤りがありましたらコメントしていただけるとありがたいです。またご意見、ご質問等がある方もコメントをしていただければと思います。よろしくお願い致します。</p>
</div></div></section><div class="it-Footer"><div class="it-Footer_actions"><div class="it-Footer_editRequest"><a href="/drafts/fa4d300786fbedf9845d/edit" class="u-link-no-underline"><span class="fa fa-fw fa-code-fork"></span><span>Edit request</span></a></div><div class="it-Footer_stock"><button><span class="fa fa-folder-open"></span><span class="it-Footer_stockLabel">Stock</span></button></div><div class="it-Footer_like"><button><span class="fa fa-fw fa-thumbs-up"></span><span>Like</span></button><a href="/e-yoshida/items/fa4d300786fbedf9845d/likers" class="it-Footer_likeCount">16</a></div></div><div class="it-Footer_social"><div class="it-Footer_shareButton it-Footer_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-facebook"><span class="fa fa-facebook"></span></div></div></div><div class="ai-Container" itemProp="author" itemscope="" itemType="http://schema.org/Person"><div class="ai-User"><a href="/e-yoshida"><img src="https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F246934%2Fprofile-images%2F1527209611?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;lossless=0&amp;w=75&amp;s=68be8949b020324d5587de56a3ad8b26" alt="e-yoshida" class="ai-User_image" itemProp="image"/></a><div class="ai-User_body"><div class="ai-User_header"><a href="/e-yoshida" class="ai-User_name">Eisuke Yoshida</a><a href="/e-yoshida" class="ai-User_urlname" itemProp="name">@<!-- -->e-yoshida</a><span itemProp="memberOf" itemscope="" itemType="http://schema.org/Organization"><a href="/organizations/ruby-dev" itemProp="url"><img src="https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/e3765eb723da6eace0557eb2085916953dc56a07/original.jpg?1527231530" alt="ruby-dev" class="ai-User_organization" itemProp="image"/></a></span></div><div class="ai-User_description">大分県の姫島で研修を行なっている新人エンジニアです。RubyとRailsがメインです。</div><a href="https://www.ruby-dev.jp/" class="ai-User_website">https://www.ruby-dev.jp/</a><div class="ai-User_footer"><button class="it-UserFollowButton it-UserFollowButton-follow">Follow</button></div></div></div><div class="ai-Organization" itemProp="memberOf" itemscope="" itemType="http://schema.org/Organization"><a href="/organizations/ruby-dev" itemProp="url"><img src="https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/e3765eb723da6eace0557eb2085916953dc56a07/original.jpg?1527231530" alt="ruby-dev" class="ai-Organization_image" itemProp="image"/></a><div class="ai-Organization_body"><div class="ai-Organization_header"><a href="/organizations/ruby-dev" class="ai-Organization_name"><span itemProp="legalName">株式会社Ruby開発</span></a></div><div class="ai-Organization_description" itemProp="description">Ruby開発はRuby on Railsをコア技術とし、Web系から基幹系まで多様な開発に携わっています。</div><a href="https://www.ruby-dev.jp/" class="ai-Organization_website">https://www.ruby-dev.jp/</a></div></div></div><div class="apm-Content"><div class="apm-Content_title">Why do not you register as a user and use Qiita more conveniently?</div><ol class="apm-Content_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li><div><a class="apm-Content_help" href="https://help.qiita.com/ja/articles/qiita-login-user" target="_blank"><i class="fa fa-fw fa-arrow-circle-right"></i>What you can do with signing up</a></div></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d&amp;realm=qiita" class="apm-Content_button apm-Content_button-signin">Login</a></div></div></div><div class="p-items_options"><div class="mt-2"></div></div><div class="p-items_toc"><div class="mt-2"></div></div></div></div><div class="p-items_wrapper p-items_wrapper-white"><div class="p-items_container"><div class="p-items_leftDummy"></div><div class="p-items_main"><div class="p-items_aside px-5 p-2@s"><div id="logly-lift-4279493"><div class="tl-DummyItemList p-2"><div class="tl-DummyItemList_content tl-DummyItem"><div class="tl-DummyItem_image mr-1"></div><div class="tl-DummyItem_body"><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div></div></div><div class="tl-DummyItemList_content tl-DummyItem"><div class="tl-DummyItem_image mr-1"></div><div class="tl-DummyItem_body"><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div></div></div><div class="tl-DummyItemList_content tl-DummyItem"><div class="tl-DummyItem_image mr-1"></div><div class="tl-DummyItem_body"><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div></div></div><div class="tl-DummyItemList_content tl-DummyItem"><div class="tl-DummyItem_image mr-1"></div><div class="tl-DummyItem_body"><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div></div></div><div class="tl-DummyItemList_content tl-DummyItem"><div class="tl-DummyItem_image mr-1"></div><div class="tl-DummyItem_body"><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div><div class="tl-DummyItem_text mb-1"></div></div></div></div></div></div><div class="p-items_aside mt-5 px-5 p-2@s"></div><div></div><div class="p-items_aside mt-6 px-5 p-2@s" id="comments-wrapper"><div id="comments" class="co-ItemWrapper"><div class="co-ItemWrapper_title mb-2"><span class="fa fa-comments mr-1"></span>Comments</div><div class="co-AnonymousForm p-3"><div class="co-AnonymousForm_title mb-1">Sign up for free and join this conversation.</div><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d&amp;realm=qiita" class="co-AnonymousForm_signup">Sign Up</a><div class="co-AnonymousForm_sub mt-1">If you already have a Qiita account <a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d&amp;realm=qiita" class="co-AnonymousForm_login">Login</a></div></div></div></div></div><div class="p-items_rightDummy"></div></div></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="PersonalPublicArticle" data-dom-id="PersonalPublicArticle-react-component-94013286-bee5-4531-a5ba-00f272337495">{"article":{"body":"\u003cp\u003e久しぶりに遭遇しました。\u003ccode\u003erails\u003c/code\u003eで\u003ccode\u003eenum\u003c/code\u003eを使う時に起きるこのエラー。\u003cbr\u003e\n今回が2回目の遭遇なのですが、前回は根本的な解決をしないまま小手先の変更で退却してしまいました。\u003cbr\u003e\nなので今回はこのエラーとじっくり向き合ってみようと思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"現在の状況\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8F%BE%E5%9C%A8%E3%81%AE%E7%8A%B6%E6%B3%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e現在の状況\u003c/h2\u003e\n\n\u003cp\u003eタスクを管理するアプリケーションを作成中です。\u003cbr\u003e\n\u003ccode\u003eTask\u003c/code\u003eモデルの\u003ccode\u003estatus_id\u003c/code\u003eカラムを\u003ccode\u003eInteger\u003c/code\u003e型保存して、\u003cbr\u003e\nビューで表示する際に\u003ccode\u003eenum\u003c/code\u003eを利用して数値に対応したステータスを表示させたいと考えています。\u003cbr\u003e\n以下コードになります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"dbschemarb\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dbschemarb\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edb/schema.rb\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"no\"\u003eActiveRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eSchema\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edefine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003eversion: \u003c/span\u003e\u003cspan class=\"mi\"\u003e20180516232642\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ecreate_table\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"tasks\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003eforce: :cascade\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estring\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"title\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enull: \u003c/span\u003e\u003cspan class=\"kp\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etext\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003edefault: \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enull: \u003c/span\u003e\u003cspan class=\"kp\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edatetime\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"created_at\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enull: \u003c/span\u003e\u003cspan class=\"kp\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edatetime\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"updated_at\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enull: \u003c/span\u003e\u003cspan class=\"kp\"\u003efalse\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edatetime\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003einteger\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"status_id\"\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appmodelstaskrb\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appmodelstaskrb\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/models/task.rb\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTask\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eApplicationRecord\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eenum\u003c/span\u003e \u003cspan class=\"ss\"\u003estatus_id: \u003c/span\u003e\u003cspan class=\"sx\"\u003e%i[undefined untouched in_prigress done]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appcontrollerstasks_controllerrb\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appcontrollerstasks_controllerrb\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/controllers/tasks_controller.rb\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTasksController\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eApplicationController\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e　　\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e\u003cspan class=\"err\"\u003e一部省略\u003c/span\u003e\u003cspan class=\"o\"\u003e~\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask_params\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esave\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eredirect_to\u003c/span\u003e \u003cspan class=\"n\"\u003eroot_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enotice: \u003c/span\u003e\u003cspan class=\"s1\"\u003e'Succeeded to save the task!!'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'new'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdate\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eupdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask_params\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eredirect_to\u003c/span\u003e \u003cspan class=\"n\"\u003eroot_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enotice: \u003c/span\u003e\u003cspan class=\"s1\"\u003e'Succeeded to save the task!!'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'edit'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"kp\"\u003eprivate\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etask_params\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:task\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003epermit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:title\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:detail\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:deadline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:status_id\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"apphelperstasks_helperrb\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#apphelperstasks_helperrb\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/helpers/tasks_helper.rb\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"k\"\u003emodule\u003c/span\u003e \u003cspan class=\"nn\"\u003eTasksHelper\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edeadline_format\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epresent?\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'%Y.%m.%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:undefined\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estatus_format\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epresence\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e  \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:undefined\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appviewstasks_formslim\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appviewstasks_formslim\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/views/tasks/_form.slim\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e= form_for(@task) do |f|\n  .form_title\n    = f.text_field :title, placeholder: t(:title), class: \"form_title__text_field\"\n  .form_detail\n    = f.text_area :detail, placeholder: t(:detail), class: \"form_detail__text_area\"\n  .form_name\n    .form_name__font = t(:deadline)\n  .form_deadline\n    = f.date_select :deadline, class: \"form_deadline_select\"\n  .form_status\n    = f.select(:status_id, {undefined: 0, untouched: 1, in_progress: 2, done: 3}, { class: \"form_status__select\" })\n  .form_submit\n    = f.submit t(:submit), class: \"form_submit__button\"\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eタスクを新規で保存する際も、既存のタスクを更新する際も同じフォームを利用しています。\u003cbr\u003e\n（\u003ccode\u003etasks/new.slim\u003c/code\u003eと\u003ccode\u003eviews/tasks/edit.slim\u003c/code\u003eの両方で同じ\u003ccode\u003eviews/tasks/_form.slim\u003c/code\u003eを\u003ccode\u003erender\u003c/code\u003eしています。）\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appviewstasksindexslim\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appviewstasksindexslim\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/views/tasks/index.slim\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  tbody.task_table__body\n    - @tasks.each.with_index do |task, n|\n      tr.task_table__line{ id = n }\n        td.task_table__line__priority = t(:s)\n        td.task_table__line__deadline = deadline_format(task.deadline)\n        td.task_table__line__title = task.title\n        td.task_table__line__detail = task.detail\n        td.task_table__line__status = status_format(task.status_id)\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"問題点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題点\u003c/h2\u003e\n\n\u003cp\u003eこの状態で新規タスクの作成と既存のタスクの更新を行うと以下のようなエラーが出てきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eCompleted 500 Internal Server Error in 4ms (ActiveRecord: 0.7ms)\n\nArgumentError ('2' is not a valid status_id):\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eエラーの意味は理解できます。\u003cbr\u003e\n引数としての\u003ccode\u003estatus_id\u003c/code\u003eが無効な値です。そして\u003ccode\u003e'2' is invalid\u003c/code\u003eと表示されているので、\u003cbr\u003e\nおそらく\u003ccode\u003eInteger\u003c/code\u003eで取得されるべき値が\u003ccode\u003eString\u003c/code\u003eで来ています、とのことだと思います。\u003c/p\u003e\n\n\u003cp\u003e試しに\u003ccode\u003eapp/models/task.rb\u003c/code\u003eの\u003ccode\u003eenum\u003c/code\u003eの記述をコメントアウトした状態で同じ動作を行ってみましたが、エラーは出てこなかったので\u003ccode\u003eenum\u003c/code\u003eに問題があるようです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"試行錯誤\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E9%8C%AF%E8%AA%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e試行錯誤\u003c/h2\u003e\n\n\u003cp\u003e先ず、本当に\u003ccode\u003estatus_id\u003c/code\u003eが\u003ccode\u003eString\u003c/code\u003e型で取得されているのかを\u003ccode\u003ebinding.pry\u003c/code\u003eを使って調べてみました。\u003cbr\u003e\n（あくまで、型を調べるためなのでエラーを回避するために\u003ccode\u003eapp/models/task.rb\u003c/code\u003eの\u003ccode\u003eenum\u003c/code\u003eの記述をコメントアウトした状態で行いました。）\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appcontrollerstasks_controllerrb-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appcontrollerstasks_controllerrb-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/controllers/tasks_controller.rb\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTasksController\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eApplicationController\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e　　\u003c/span\u003e \u003cspan class=\"o\"\u003e~~\u003c/span\u003e\u003cspan class=\"err\"\u003e一部省略\u003c/span\u003e\u003cspan class=\"o\"\u003e~~\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebindung\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epry\u003c/span\u003e\n    \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask_params\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esave\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eredirect_to\u003c/span\u003e \u003cspan class=\"n\"\u003eroot_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enotice: \u003c/span\u003e\u003cspan class=\"s1\"\u003e'Succeeded to save the task!!'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'new'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdate\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eupdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask_params\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eredirect_to\u003c/span\u003e \u003cspan class=\"n\"\u003eroot_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enotice: \u003c/span\u003e\u003cspan class=\"s1\"\u003e'Succeeded to save the task!!'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'edit'\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"kp\"\u003eprivate\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etask_params\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003erequire\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:task\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003epermit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"ss\"\u003e:title\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:detail\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:deadline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003e:status_id\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以下がデバックした際のターミナル画面です。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n    \u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"nb\"\u003ebinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epry\u003c/span\u003e\n \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask_params\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e17\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esave\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"n\"\u003eredirect_to\u003c/span\u003e \u003cspan class=\"n\"\u003eroot_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enotice: \u003c/span\u003e\u003cspan class=\"s1\"\u003e'Succeeded to save the task!!'\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e19\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'new'\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e21\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e23\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; task_params\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"no\"\u003eActionController\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eParameters\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"title\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"test for status\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline(1i)\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2018\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline(2i)\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"5\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline(3i)\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"17\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"status_id\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"ss\"\u003epermitted: \u003c/span\u003e\u003cspan class=\"kp\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; status = task_params[:status_id]\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"2\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; status.class\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"no\"\u003eString\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eやっぱり…\u003cbr\u003e\nそして\u003ccode\u003edatetime\u003c/code\u003e型であるはずの\u003ccode\u003edeadline\u003c/code\u003eも\u003ccode\u003estring\u003c/code\u003eになっている…\u003c/p\u003e\n\n\u003cp\u003e今度は\u003ccode\u003ebinding.pry\u003c/code\u003eの位置を変えて実行。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n    \u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eTask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etask_params\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"nb\"\u003ebinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epry\u003c/span\u003e\n \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e17\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@task\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esave\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"n\"\u003eredirect_to\u003c/span\u003e \u003cspan class=\"n\"\u003eroot_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ss\"\u003enotice: \u003c/span\u003e\u003cspan class=\"s1\"\u003e'Succeeded to save the task!!'\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e19\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"n\"\u003erender\u003c/span\u003e \u003cspan class=\"s1\"\u003e'new'\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e21\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e     \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n    \u003cspan class=\"mi\"\u003e23\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; @task\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"c1\"\u003e#\u0026lt;Task:0x00007f981adc0398\u003c/span\u003e\n \u003cspan class=\"ss\"\u003eid: \u003c/span\u003e\u003cspan class=\"kp\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"ss\"\u003etitle: \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"明日の夕方、海岸へ行く\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"ss\"\u003edetail: \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"ss\"\u003ecreated_at: \u003c/span\u003e\u003cspan class=\"kp\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"ss\"\u003eupdated_at: \u003c/span\u003e\u003cspan class=\"kp\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"ss\"\u003edeadline: \u003c/span\u003e\u003cspan class=\"no\"\u003eFri\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e18\u003c/span\u003e \u003cspan class=\"no\"\u003eMay\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e \u003cspan class=\"mo\"\u003e00\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mo\"\u003e00\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mo\"\u003e00\u003c/span\u003e \u003cspan class=\"no\"\u003eJST\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e09\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mo\"\u003e00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n \u003cspan class=\"ss\"\u003estatus_id: \u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; @task[:status_id]\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; @task[:status_id].class\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"no\"\u003eInteger\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eちゃんと\u003ccode\u003einteger\u003c/code\u003eになっていました。\u003cbr\u003e\n\u003ccode\u003edeadline\u003c/code\u003eも\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; @task[:deadline].class\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"no\"\u003eActiveSupport\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eTimeWithZone\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e一瞬、えっ？っとなりましたがこれで問題ないようです。以下参照。\u003cbr\u003e\n\u003ca href=\"http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eでは、\u003ccode\u003etask_params\u003c/code\u003e自体はどのようになっているのだろうか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; task_params\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"no\"\u003eActionController\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eParameters\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"title\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"TEST\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"detail\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline(1i)\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2018\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline(2i)\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"5\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deadline(3i)\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"19\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"status_id\"\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"ss\"\u003epermitted: \u003c/span\u003e\u003cspan class=\"kp\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003epry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"c1\"\u003e#\u0026lt;TasksController\u0026gt;)\u0026gt; task_params[:status_id].class\u003c/span\u003e\n\u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"no\"\u003eString\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこちらは変わらず\u003ccode\u003estring\u003c/code\u003eのまま。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"推測\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A8%E6%B8%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e推測\u003c/h2\u003e\n\n\u003cp\u003e上記の試行錯誤を基に\u003ccode\u003e@task\u003c/code\u003eに値が代入される流れを確認。\u003cbr\u003e\n※まだ\u003ccode\u003eActionController\u003c/code\u003eのソースをあまり理解できないのであくまで推測に近いです。\u003c/p\u003e\n\n\u003cp\u003e①\u003ccode\u003eform_for\u003c/code\u003eで入力して、取得した値は\u003cstrong\u003eキーもバリューも全て\u003ccode\u003eString\u003c/code\u003eのパラメーターのハッシュ\u003c/strong\u003eに格納される。（そりゃ、画面から送られてくるPOSTデータには型情報が無いですもんね…）\u003c/p\u003e\n\n\u003cp\u003e②\u003ccode\u003eTask\u003c/code\u003eクラスのインスタンスを作成する際に\u003ccode\u003eActiveRecord\u003c/code\u003eが\u003ccode\u003edb/schema.rb\u003c/code\u003eを参照して、キーがシンボルのカラム名のハッシュオブジェクトを作成する。（引数なしの\u003ccode\u003enew\u003c/code\u003eメソッドの後に\u003ccode\u003ebinding.pry\u003c/code\u003eを実行して確認。）\u003c/p\u003e\n\n\u003cp\u003e③\u003ccode\u003eActiveRecord\u003c/code\u003eがパラメーターのハッシュのバリューを\u003ccode\u003edb/schema.rb\u003c/code\u003eに基づいて適切な形（データ型）に変換して、\u003ccode\u003eTask\u003c/code\u003eクラスのインスタンスの該当キーのバリューとして代入する。\u003c/p\u003e\n\n\u003cp\u003eそして③が実行される際に、本来\u003ccode\u003eInteger\u003c/code\u003eであるはずのの\u003ccode\u003estatus_id\u003c/code\u003eが\u003ccode\u003eString\u003c/code\u003eのままでハッシュに渡されているからエラーが起こると思っていました。\u003c/p\u003e\n\n\u003cp\u003eけど、よく考えたらそんなことあり得ないです。\u003ccode\u003edeadline\u003c/code\u003eはちゃんと\u003ccode\u003eActiveSupport::TimeWithZone\u003c/code\u003eクラスのオブジェクトに変換されているのだから。\u003c/p\u003e\n\n\u003cp\u003eということは、\u003ccode\u003eenum\u003c/code\u003eに関して根幹的に誤解している可能性が出てきました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"enumに関する勘違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#enum%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%8B%98%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eenum\u003c/code\u003eに関する勘違い\u003c/h2\u003e\n\n\u003cp\u003e結論から言うと自分は今まで\u003ccode\u003eenum\u003c/code\u003eの機能は、DBに保存されている数値を取り出した際に、対応する文字列に変換して扱うことができることだと思っていました。\u003c/p\u003e\n\n\u003cp\u003eしかし実際は\u003cstrong\u003eモデルを介してデータのやり取りをする際に数値と、それに対応する文字列を変換する\u003c/strong\u003eことが\u003ccode\u003eenum\u003c/code\u003eの機能なのです。（日本語が分かり辛くてすいません。要は数値から文字列への変換を一方通行で行うわけじゃないよ、ということです。）\u003c/p\u003e\n\n\u003cp\u003eつまり、値がモデルクラスのインスタンスに代入される際も、\u003ccode\u003eenum\u003c/code\u003eで設定した値しか受け付けないと言うことです。と言うことはただ単に、フォームで設定するバリューを\u003ccode\u003eenum\u003c/code\u003eで設定している文字列に変えれば良いだけ。そもそもエラーを読んだ時点で認識を誤っていました。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解決\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決\u003c/h2\u003e\n\n\u003cp\u003eフォームを以下のように編集すればOK\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"appviewstasks_formslim-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#appviewstasks_formslim-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eapp/views/tasks/_form.slim\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e= form_for(@task) do |f|\n  .form_title\n    = f.text_field :title, placeholder: t(:title), class: \"form_title__text_field\"\n  .form_detail\n    = f.text_area :detail, placeholder: t(:detail), class: \"form_detail__text_area\"\n  .form_name\n    .form_name__font = t(:deadline)\n  .form_deadline\n    = f.date_select :deadline, class: \"form_deadline_select\"\n  .form_status\n    = f.select(:status_id, {undefined: 'undefined', untouched: 'untouched', in_progress: 'in_progress', done: 'done'}, { class: \"form_status__select\" })\n  .form_submit\n    = f.submit t(:submit), class: \"form_submit__button\"\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以上、たかが\u003ccode\u003eenum\u003c/code\u003eされど\u003ccode\u003eenum\u003c/code\u003eでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"お願い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E9%A1%98%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eお願い\u003c/h2\u003e\n\n\u003cp\u003e記事の内容に誤りがありましたらコメントしていただけるとありがたいです。またご意見、ご質問等がある方もコメントをしていただければと思います。よろしくお願い致します。\u003c/p\u003e\n","createdAt":"2018-05-17T02:32:28Z","elapsedYearsFromUpdatedAt":1,"isDeprecated":true,"isDestroyableByViewer":false,"isEditRequestSendableByViewer":true,"isLikableByViewer":true,"isLikedByViewer":false,"isPublic":true,"isSlide":false,"isStockableByViewer":true,"isStockedByViewer":false,"isUpdatableByViewer":false,"isUpdated":true,"likesCount":16,"originalId":646242,"title":"enumを使うとArgumentError in TasksController#create =\u003e '2' is not a valid status_id","toc":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E7%8F%BE%E5%9C%A8%E3%81%AE%E7%8A%B6%E6%B3%81\"\u003e現在の状況\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#dbschemarb\"\u003edb/schema.rb\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#appmodelstaskrb\"\u003eapp/models/task.rb\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#appcontrollerstasks_controllerrb\"\u003eapp/controllers/tasks_controller.rb\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#apphelperstasks_helperrb\"\u003eapp/helpers/tasks_helper.rb\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#appviewstasks_formslim\"\u003eapp/views/tasks/_form.slim\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#appviewstasksindexslim\"\u003eapp/views/tasks/index.slim\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e問題点\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E9%8C%AF%E8%AA%A4\"\u003e試行錯誤\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#appcontrollerstasks_controllerrb-1\"\u003eapp/controllers/tasks_controller.rb\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%8E%A8%E6%B8%AC\"\u003e推測\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#enum%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%8B%98%E9%81%95%E3%81%84\"\u003eenumに関する勘違い\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E8%A7%A3%E6%B1%BA\"\u003e解決\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#appviewstasks_formslim-1\"\u003eapp/views/tasks/_form.slim\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E3%81%8A%E9%A1%98%E3%81%84\"\u003eお願い\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","totalPv":2155,"updatedAt":"2018-05-25T08:12:36Z","uuid":"fa4d300786fbedf9845d","adventCalendarItem":null,"author":{"description":"大分県の姫島で研修を行なっている新人エンジニアです。RubyとRailsがメインです。","name":"Eisuke Yoshida","profileImageUrl":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F246934%2Fprofile-images%2F1527209611?ixlib=rb-1.2.2\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=f1f102c09b3dfa60cd9252766d7cd506","profileImageUrlW48":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F246934%2Fprofile-images%2F1527209611?ixlib=rb-1.2.2\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=f1f102c09b3dfa60cd9252766d7cd506","profileImageUrlW75":"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F246934%2Fprofile-images%2F1527209611?ixlib=rb-1.2.2\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=68be8949b020324d5587de56a3ad8b26","urlName":"e-yoshida","isFollowedByViewer":false,"isFollowableByViewer":true,"websiteUrl":"https://www.ruby-dev.jp/","organizations":{"edges":[{"node":{"name":"株式会社Ruby開発","logoUrl":"https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/e3765eb723da6eace0557eb2085916953dc56a07/original.jpg?1527231530","urlName":"ruby-dev","description":"Ruby開発はRuby on Railsをコア技術とし、Web系から基幹系まで多様な開発に携わっています。","url":"https://www.ruby-dev.jp/"}}]}},"tags":[{"name":"Rails","urlName":"rails"},{"name":"ActiveRecord","urlName":"activerecord"},{"name":"enum","urlName":"enum"}],"followingLikers":{"edges":[]},"comments":{"totalCount":0}},"viewer":null,"analyticsTrackingId":null}</script>
      
<footer id="globalFooter" class="st-Footer"><div class="st-Footer_container"><div class="st-Footer_start"><div class="st-Footer_logo"><svg viewbox="0 0 426.57 130" xmlns="http://www.w3.org/2000/svg"><circle cx="167.08" cy="21.4" r="12.28" /><path d="M250.81 29.66h23.48v18.9h-23.48z" /><path d="M300.76 105.26a22.23 22.23 0 01-6.26-.86 12.68 12.68 0 01-5.17-3 14.41 14.41 0 01-3.56-5.76 28 28 0 01-1.3-9.22V48.56h29.61v-18.9h-29.52V3.29h-20.17v83.34q0 11.16 2.83 18.27a27.71 27.71 0 007.7 11.2 26.86 26.86 0 0011.43 5.62 47.56 47.56 0 0012.34 1.53h15.16v-18zM0 61.7a58.6 58.6 0 015-24.21A62.26 62.26 0 0118.73 17.9 63.72 63.72 0 0139 4.78 64.93 64.93 0 0164 0a65 65 0 0124.85 4.78 64.24 64.24 0 0120.38 13.12A62 62 0 01123 37.49a58.6 58.6 0 015 24.21 58.34 58.34 0 01-4 21.46 62.8 62.8 0 01-10.91 18.16l11.1 11.1a10.3 10.3 0 010 14.52 10.29 10.29 0 01-14.64 0l-12.22-12.41a65 65 0 01-15.78 6.65 66.32 66.32 0 01-17.55 2.3 64.63 64.63 0 01-45.23-18A62.82 62.82 0 015 85.81 58.3 58.3 0 010 61.7zm21.64.08a43.13 43.13 0 0012.42 30.63 42.23 42.23 0 0013.43 9.09A41.31 41.31 0 0064 104.8a42 42 0 0030-12.39 42.37 42.37 0 009-13.64 43.43 43.43 0 003.3-17 43.77 43.77 0 00-3.3-17A41.7 41.7 0 0080.55 22 41.78 41.78 0 0064 18.68 41.31 41.31 0 0047.49 22a42.37 42.37 0 00-13.43 9.08 43.37 43.37 0 00-12.42 30.7zM331.89 78a47.59 47.59 0 013.3-17.73 43.22 43.22 0 019.34-14.47A44.25 44.25 0 01359 36a47.82 47.82 0 0118.81-3.58 42.72 42.72 0 019.26 1 46.5 46.5 0 018.22 2.58 40 40 0 017 3.84 44.39 44.39 0 015.71 4.63l1.22-9.47h17.35v85.83h-17.35l-1.17-9.42a42.54 42.54 0 01-5.84 4.67 43.11 43.11 0 01-7 3.79 44.86 44.86 0 01-8.17 2.59 43 43 0 01-9.22 1A47.94 47.94 0 01359 119.9a43.3 43.3 0 01-14.47-9.71 44.17 44.17 0 01-9.34-14.47 47 47 0 01-3.3-17.72zm20.27-.08a29.16 29.16 0 002.17 11.34 27 27 0 005.92 8.88 26.69 26.69 0 008.76 5.76 29.19 29.19 0 0021.44 0 26.11 26.11 0 008.72-5.76 27.57 27.57 0 005.88-8.84 29 29 0 002.16-11.38 28.62 28.62 0 00-2.16-11.22 26.57 26.57 0 00-5.93-8.8 27.68 27.68 0 00-19.51-7.9 28.29 28.29 0 00-10.77 2.05 26.19 26.19 0 00-8.71 5.75 27.08 27.08 0 00-5.84 8.8 28.94 28.94 0 00-2.13 11.31zm-194.97-30.5h19.78v73.54h-19.78zm49.25 0h19.78v73.54h-19.78z" /><circle cx="216.33" cy="21.4" r="12.28" /></svg></div><div class="st-Footer_catchcopy">How developers code is here.</div><div class="st-Footer_socials"><a class="fa fa-twitter" href="https://twitter.com/qiita"></a><a class="fa fa-facebook-square" href="https://www.facebook.com/qiita/"></a></div></div><div class="st-Footer_end"><div class="st-Footer_qiita"><div class="st-Footer_label">Qiita</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="/about">About</a><a href="/terms">Terms</a><a href="/privacy">Privacy</a><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a></div><div class="st-Footer_column"><a href="/api/v2/docs">API</a><a href="/feedback/new">ご意見</a><a href="https://help.qiita.com">Help</a><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></div></div></div><div class="st-Footer_increments"><div class="st-Footer_label">Increments</div><div class="st-Footer_list"><div class="st-Footer_column"><a href="https://increments.co.jp/company/">About</a><a href="https://increments.co.jp/jobs/">採用情報</a><a href="https://blog.qiita.com">Blog</a></div><div class="st-Footer_column"><a href="https://teams.qiita.com/">Qiita Team</a><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a><a href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Zine</a></div></div></div></div></div><div class="st-Footer_copyright">© 2011-2019 Increments Inc.</div></footer><div class="p-messages"><div id="Snackbar-react-component-3a3345f5-ccb7-4226-9ed9-dee8ed90cedb"><div class="msg-Container"><div class="msg-Item msg-Item- msg-Item-dismissible" style="visibility:hidden;opacity:0;transition:visibility 0ms 50ms, opacity 50ms linear"><div class="msg-Item_body"></div><button class="msg-Item_dismiss"><span class="fa fa-close"></span></button></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Snackbar" data-dom-id="Snackbar-react-component-3a3345f5-ccb7-4226-9ed9-dee8ed90cedb">{}</script>
      
</div><div id="LoginModal-react-component-a8865781-0ab4-4825-8ebd-374659aa1f12"><div class="st-Modal"><div class="st-Modal_backdrop"></div><div class="st-Modal_body lm-Dialog"><div class="fa fa-times lm-Dialog_close"></div><div class="lm-Dialog_title">Why do not you register as a user and use Qiita more conveniently?</div><div class="lm-Dialog_message-pc">You need to log in to use this function. Qiita can be used more conveniently after logging in.</div><div class="lm-Dialog_message-mobile">You seem to be reading articles frequently this month. Qiita can be used more conveniently after logging in.</div><ol class="lm-Dialog_list"><li>We will deliver articles that match you<div class="description">By following users and tags, you can catch up information on technical fields that you are interested in as a whole</div></li><li>you can read useful information later efficiently<div class="description">By &quot;stocking&quot; the articles you like, you can search right away</div></li></ol><a href="/signup?callback_action=login_or_signup&amp;redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d&amp;realm=qiita" class="lm-Dialog_button lm-Dialog_button-signup">Sign up</a><a href="/login?callback_action=login_or_signup&amp;redirect_to=%2Fe-yoshida%2Fitems%2Ffa4d300786fbedf9845d&amp;realm=qiita" class="lm-Dialog_button lm-Dialog_button-signin">Login</a></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="LoginModal" data-dom-id="LoginModal-react-component-a8865781-0ab4-4825-8ebd-374659aa1f12">{}</script>
      
</div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;mixpanelToken&quot;:&quot;17d24b448ca579c365d2d1057f3a1791&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;JqyFZeRNIBLTp/KHmiZgKn7+sRMPrO90wj53oEM+wzA1Yqxw9boivxBTeEqKnOKZhuhCZ9k3xHsxR46mMZ8Ckg==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html><script type="application/json" data-js-react-on-rails-store="AppStore">{"snackbar":{"type":"","body":"","isActive":false}}</script>